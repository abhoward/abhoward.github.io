<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    </head>
    <body>
        <style type="text/css">
            img {
                /*border: 2px solid;*/
                /*background-color: #cccccc;*/
            }

            body {
                background-color: #777777;
            }

            span {
                font-size: 36pt;
                white-space: nowrap;
                overflow: hidden;
            }

            select {
                text-align: center;
                width:10%;
                /*float: right;*/
                padding: 10px;
            }

            #addButton {
                background-color: green;
                color: white;
                font-size: 25px;
                padding: 1px 50px;
                border: 2px solid black;
                border-radius: 6px;
                transition-duration: 0.1s;
                cursor:pointer;
            }

            #subButton {
                background-color: darkred;
                color:  white;
                font-size: 25px;
                padding: 1px 50px;
                border: 2px solid black;
                border-radius: 6px;
                transition-duration: 0.1s;
                cursor:pointer;
            }

            #addButton:hover {
                background-color: seagreen; 
                color: white;
            }

            #subButton:hover {
                background-color: indianred; 
                color: white;
            }

            /*#counter-node {
                border: 2px dashed;
            }*/
        </style>
        <div id="counter-node">
            <div>
                <center>
                    <img id="pokemon-sprite" src="" width="10%" height="10%">
                    <br>
                    <h1><span id="counter-number" contenteditable="false">0</span></h1>
                    <br>
                </center>
            </div>
            <center>
                <div>
                    <button id="addButton" onclick="incrementClick()">+</button>
                    <button id="subButton" onclick="decrementClick()">-</button>
                </div>
                <br>
                <div>
                    <form id="hunt-info"><h1>Settings:</h1>
                        <!-- <b>Generation:</b> -->
                        <select onchange="saveSettings()" id="gen-select" >
                            <option selected disabled>Choose a generation</option>
                        </select><br><br>
                        <!-- <b>Game:</b> -->
                        <select onchange="saveSettings()" id="pokemon-game">
                            <option selected disabled>Choose a game</option>
                        </select><br><br>
                        <!-- <b>Target:</b> -->
                        <select onchange="saveSettings()" id="pokemon-name">
                            <option selected disabled>Choose a Pokemon</option>
                        </select><br>
                    </form><br>
                    <button onclick="saveSettings()">Save Settings</button>
                    <button onclick="resetCounter()">RESET</button>
                </div>
                <br>
                <!-- <div>
                    <button onclick="addCounter()">Add Counter</button>
                </div> -->
            </center>
        </div>
        <br>
        <script type="text/javascript">
            var pokemonInfo = 'https://raw.githubusercontent.com/abhoward/abhoward.github.io/main/data/pokemon/pokemon_info.json'
            ajaxCalls();
            initializeSettings();

            function initializeSettings() {
                if (getCounter() != 0) {
                    var counter = getCounter();
                    updateCounter(counter);
                } else {
                    var counter = 0;
                }

                if (getName() != 'Red') {
                    var pokemonName = getName();
                    updateName(pokemonName);
                } else {
                    pokemonName = 'Red';
                }

                if (getGen() != 'Gen1') {
                    var pokemonGen = getGen();
                    updateGen(pokemonGen);
                }
                else {
                    var pokemonGen = 'Generation 1'
                }

                if (getGame() != 'Red') {
                    var pokemonGame = getGame();
                    updateGame(pokemonGame);
                }

                if (getSprite() != '') {
                    var pokemonSprite = getSprite();
                    updateSprite(pokemonSprite);
                }
            }

            function incrementClick() {
                counter = getCounter();
                updateCounter(++counter);
                storeCounter(counter);
            }

            function decrementClick() {
                counter = getCounter()
                if (counter > 0) {
                    updateCounter(--counter);
                    storeCounter(counter);
                }
            }

            function resetCounter() {
                counter = 0;
                updateCounter(counter);
                storeCounter(counter);
            }

            //----------------Update Functions----------------
            function updateCounter(value) {
                document.getElementById("counter-number").innerHTML = value;
            }

            function updateGen(value) {
                document.getElementById("gen-select").value = value;
            }

            function updateName(value) {
                document.getElementById("pokemon-name").value = value;
            }

            function updateGame(value) {
                document.getElementById("pokemon-game").value = value;
            }

            function updateSprite(value) {
                document.getElementById("pokemon-sprite").src = value;
            }

            //----------------Store Functions----------------
            function storeCounter(value) {
                localStorage.setItem("count", value);
            }

            function storeGen(value) {
                localStorage.setItem("gen", value);
            }

            function storeGame(value) {
                localStorage.setItem("game", value);
                console.log(value);
            }

            function storeName(value) {
                localStorage.setItem("name", value);
            }

            function storeSprite(value) {
                localStorage.setItem("sprite", value);
            }

            //----------------Get Functions----------------
            function getCounter() {
                var count = localStorage.getItem("count") || 0;
                return count;
            }

            function getGen() {
                var gen = localStorage.getItem("gen") || 'Generation 1';
                return gen
            }

            function getGame() {
                var game = localStorage.getItem("game") || 'Red';
                return game;
            }

            function getName() {
                var name = localStorage.getItem("name") || 'Bulbasaur';
                return name;
            }

            function getSprite() {
                var sprite = localStorage.getItem("sprite") || 'https://raw.githubusercontent.com/abhoward/abhoward.github.io/main/assets/pokemon/sprites/generation1/red/1.png';
                return sprite
            }

            // function addCounter() {
            //     var itm = document.getElementById("counter-node");
            //     var cln = itm.cloneNode(true);
            //     document.body.appendChild(cln);
            // }

            function addOptions(data) {
                var selectedGen = document.getElementById("gen-select");
                var selectedGame = document.getElementById("pokemon-game");
                var selectedPokemon = document.getElementById("pokemon-name");
                
                gens = Object.keys(data);
                pokemon = data[getGen()]['pokemon'];
                games = data[getGen()]['games'];

                for (var i = 0; i < gens.length; i++) {
                    var option = gens[i];
                    var element = document.createElement("option");

                    element.text = option;
                    element.value = option;
                    selectedGen.options.add(element);
                    updateGen(getGen());
                }

                for (var i = 0; i < games.length; i++) {
                    var option = games[i];
                    var element = document.createElement("option");

                    element.text = option;
                    element.value = option;
                    selectedGame.options.add(element);
                    updateGame(getGame());
                }

                for (var i = 0; i < pokemon.length; i++) {
                    var option = pokemon[i];
                    var element = document.createElement("option");

                    element.text = option;
                    element.value = option;
                    selectedPokemon.add(element);
                    updateName(getName());
                }
            }

            function saveSettings() {
                var pokemonGen = document.getElementById("gen-select").value;
                var pokemonGame = document.getElementById("pokemon-game").value;
                var pokemonName = document.getElementById("pokemon-name").value;
                var source = "https://play.pokemonshowdown.com/sprites/ani-shiny/" + pokemonName.toLowerCase() + ".gif"
                // var source = 'https://raw.githubusercontent.com/abhoward/abhoward.github.io/main/assets/pokemon/sprites/generation1/blue/1.png'

                storeSprite(source);
                storeName(pokemonName);
                storeGame(pokemonGame);
                storeGen(pokemonGen);

                updateSprite(source);
            }

            function ajaxCalls() {
                return [
                    $.ajax({
                        url: pokemonInfo,
                        dataType: 'json'
                    })
                ];
            }

            $.when.apply($, ajaxCalls()).then(addOptions);

            // $('.counter-number').on('DOMSubtreeModified',function(){
            //   alert('changed')
            // })
        </script>
    </body>
</html>