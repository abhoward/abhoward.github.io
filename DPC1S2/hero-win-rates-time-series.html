<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script type="text/javascript" src="https://code.highcharts.com/highcharts.js"></script>
        <script type="text/javascript" src="https://code.highcharts.com/highcharts-more.js"></script>
        <script type="text/javascript" src="https://code.highcharts.com/modules/drilldown.js"></script>
    </head>
    <body style="margin:0;padding:0;height:100vh">
        <div id="container" style="width:100%;height:100%">Loading....</div>
        <script>
            var heroMatchesPlayedLink = 'https://raw.githubusercontent.com/abhoward/abhoward.github.io/main/data/DPC1S2/animajor/hero_matches_played.json';
            var heroMatchesWonLink = 'https://raw.githubusercontent.com/abhoward/abhoward.github.io/main/data/DPC1S2/animajor/hero_matches_won.json';
            var heroWinRatesLink = 'https://raw.githubusercontent.com/abhoward/abhoward.github.io/main/data/DPC1S2/animajor/hero_win_rates.json';
            var totalTeamHeroesLink = 'https://raw.githubusercontent.com/abhoward/abhoward.github.io/main/data/DPC1S2/animajor/total_team_heroes.json';

            function createHighchart(data1, data2, data3, data4) {
                var heroMatchesPlayed = data1[0];
                var heroMatchesWon = data2[0];
                var heroWinRates = data3[0];
                var totalTeamHeroes = data4[0];

                Highcharts.chart('container', {
                    'chart': {
                        'type': 'areaspline',
                        'zoomType': 'x'
                    },
                    'title': {
                        'text': 'Hero Win Rates'
                    },
                    'subtitle': {
                        'text': 'Click on the bars or hero names to drill down to team stats. Source: opendota.com.<br><i>Excludes matches <code>6025172903</code>, <code>6023211594</code> and <code>6023110186</code> due to lack of data.</i>'
                    },
                    'legend': {
                        'verticalAlign': 'top'
                    },
                    'plotOptions': {
                        'series': {
                            'grouping': false
                        },
                        'spline': {
                            'zones': [
                                {
                                'value': 0.25, 
                                'color': '#f56969'
                                }, 
                                {
                                'value': 0.5, 
                                'color': '#d8db53'
                                }, 
                                {'value': 0.9, 
                                 'color': '#1ac73d'
                                }, 
                                {'value': 1.01, 
                                 'color': '#1a48c7'
                                }
                            ]
                        },
                        'areaspline': {
                            'fillColor': {
                                'linearGradient': {'x1': 0, 'x2': 0, 'y1': 1, 'y2': 0},
                                'stops': [
                                    [0, '#6B0000'],
                                    [0.125, '#B03535'],
                                    [0.25, '#F56969'],
                                    [0.375, '#E7A25E'],
                                    [0.5, '#d8db53'],
                                    [0.625, '#79D148'],
                                    [0.75, '#1AC73D'],
                                    [0.875, '#1A8882'],
                                    [1, '#1A48C7']
                                ],
                            },
                            'opacity': 0.7
                        }
                    },
                    'tooltip': {
                        'shared': true,
                        'pointFormatter': function() {
                            var value;
                            if (this.series.name.includes("Win Rate")) {
                                value = this.y*100;
                                value = value.toFixed(2) + '%'
                            } else {
                                value = this.y.toLocaleString(undefined, {'minimumFractionDigits':0, 'maximumFractionDigits':0});
                            }
                            if (typeof this.zone.color != "undefined") {
                                return '<span style="color:' + this.zone.color + '">' + this.series.name + '</span>: <b>' + value + '</b><br />';
                            } else {
                                return '<span style="color:' + this.series.color + '">' + this.series.name + '</span>: <b>' + value + '</b><br />' + this.series.id;
                            }
                        },
                        'headerFormat': '<b>{point.key}</b><br>'
                    },
                    'xAxis': {
                        'type': 'category',
                        'title': {
                            'text': 'Hero'
                        }
                    },
                    'yAxis': { // Primary Axis
                        'min': 0,
                        'title': {
                            'text': 'Number of Matches'
                        },
                        'labels': {
                            'formatter': function () {
                                var value = Math.trunc(this.value*100);
                                return value + '%';
                            }
                        }
                    },
                    'series': [
                        {
                            'type': 'spline',
                            'name': 'Pick Rate',
                            'color': 'rgba(72, 219, 119, 1)',
                            'lineWidth': 0,
                            'states': {
                                'hover': {
                                    'enabled': false
                                }
                            },
                            'marker': {
                                'symbol': 'diamond'
                            },
                            'data': heroWinRates
                        },
                        {
                            'type': 'spline',
                            'name': 'Ban Rate',
                            'color': 'rgba(72, 219, 119, 1)',
                            'lineWidth': 0,
                            'states': {
                                'hover': {
                                    'enabled': false
                                }
                            },
                            'marker': {
                                'symbol': 'diamond'
                            },
                            'data': heroWinRates
                        },
                        {
                            'type': 'spline',
                            'name': 'Win Rate',
                            'color': 'rgba(72, 219, 119, 1)',
                            'lineWidth': 0,
                            'states': {
                                'hover': {
                                    'enabled': false
                                }
                            },
                            'marker': {
                                'symbol': 'diamond'
                            },
                            'data': heroWinRates
                        }
                    ],
                    'drilldown': {
                        'drillUpButton': {
                            'theme': {
                                'fill': 'white',
                                'stroke-width': 1,
                                'stroke': 'silver',
                                'r': 0
                            }
                        },
                        'series': 
                        [{'name': 'Legion Commander Win Rate',
                          'id': 'Legion Commander Win Rate',
                          'data': [[1622631939.0, 0.0],
                           [1622729379.0, 0.0],
                           [1622808907.0, 0.3333333333333333],
                           [1622822865.0, 0.25]]},
                         {'name': 'Troll Warlord Win Rate',
                          'id': 'Troll Warlord Win Rate',
                          'data': [[1622631939.0, 0.0],
                           [1622656597.0, 0.0],
                           [1623060003.0, 0.0],
                           [1623316867.0, 0.25],
                           [1623340375.0, 0.4],
                           [1623488462.0, 0.3333333333333333]]},
                         {'name': 'Puck Win Rate',
                          'id': 'Puck Win Rate',
                          'lineWidth': 0,
                          'marker': {
                            'enabled': true,
                            'symbol': 'diamond'
                          },
                          'data': [[1622631939.0, 1.0],
                           [1622637744.0, 1.0],
                           [1622642467.0, 0.6666666666666666],
                           [1622650991.0, 0.75],
                           [1622722138.0, 0.8],
                           [1622729379.0, 0.8333333333333334],
                           [1622732908.0, 0.8571428571428571],
                           [1622808887.0, 0.75],
                           [1622814077.0, 0.6666666666666666],
                           [1622818537.0, 0.7],
                           [1622822563.0, 0.6363636363636364],
                           [1622822865.0, 0.6666666666666666],
                           [1622826222.0, 0.6153846153846154],
                           [1622831088.0, 0.6428571428571429],
                           [1622831318.0, 0.6666666666666666],
                           [1622890797.0, 0.6875],
                           [1622910331.0, 0.6470588235294118],
                           [1622915706.0, 0.6666666666666666],
                           [1622977177.0, 0.631578947368421],
                           [1622977260.0, 0.65],
                           [1623003165.0, 0.6190476190476191],
                           [1623069370.0, 0.6363636363636364],
                           [1623080346.0, 0.6086956521739131],
                           [1623096134.0, 0.625],
                           [1623240078.0, 0.64],
                           [1623326349.0, 0.6153846153846154],
                           [1623336307.0, 0.5925925925925926],
                           [1623412949.0, 0.6071428571428571],
                           [1623429205.0, 0.6206896551724138],
                           [1623488462.0, 0.6333333333333333],
                           [1623492171.0, 0.6451612903225806],
                           [1623497683.0, 0.625],
                           [1623518001.0, 0.6363636363636364],
                           [1623528443.0, 0.6470588235294118],
                           [1623532965.0, 0.6285714285714286],
                           [1623590649.0, 0.6388888888888888],
                           [1623601209.0, 0.6486486486486487]]},
                         {'name': 'Nyx Assassin Win Rate',
                          'id': 'Nyx Assassin Win Rate',
                          'data': [[1622631939.0, 0.0],
                           [1622642467.0, 0.5],
                           [1622642538.0, 0.3333333333333333],
                           [1622646441.0, 0.5],
                           [1622652015.0, 0.6],
                           [1622655993.0, 0.6666666666666666],
                           [1622664784.0, 0.7142857142857143],
                           [1622736322.0, 0.75],
                           [1622751689.0, 0.7777777777777778],
                           [1622835214.0, 0.7],
                           [1622835495.0, 0.7272727272727273],
                           [1622895568.0, 0.6666666666666666],
                           [1622900137.0, 0.6923076923076923],
                           [1622914161.0, 0.7142857142857143],
                           [1622915706.0, 0.7333333333333333],
                           [1622985258.0, 0.6875],
                           [1622990163.0, 0.7058823529411765],
                           [1623006718.0, 0.6666666666666666],
                           [1623063371.0, 0.631578947368421],
                           [1623075039.0, 0.6],
                           [1623230671.0, 0.5714285714285714],
                           [1623260677.0, 0.5454545454545454],
                           [1623532965.0, 0.5652173913043478],
                           [1623595046.0, 0.5833333333333334]]},
                         {'name': 'Rubick Win Rate',
                          'id': 'Rubick Win Rate',
                          'data': [[1622631939.0, 1.0],
                           [1622652015.0, 0.5],
                           [1622656597.0, 0.3333333333333333],
                           [1622903553.0, 0.25],
                           [1622985258.0, 0.4],
                           [1623080346.0, 0.5],
                           [1623251394.0, 0.42857142857142855],
                           [1623336307.0, 0.375],
                           [1623412949.0, 0.3333333333333333],
                           [1623429205.0, 0.3]]},
                         {'name': 'Tiny Win Rate',
                          'id': 'Tiny Win Rate',
                          'data': [[1622631939.0, 0.0],
                           [1622637744.0, 0.0],
                           [1622642467.0, 0.0],
                           [1622660725.0, 0.0],
                           [1622717946.0, 0.0],
                           [1622808887.0, 0.0],
                           [1622808907.0, 0.0],
                           [1622814077.0, 0.125],
                           [1622817328.0, 0.1111111111111111],
                           [1622826627.0, 0.1],
                           [1622831088.0, 0.09090909090909091],
                           [1622895568.0, 0.16666666666666666],
                           [1622903553.0, 0.23076923076923078],
                           [1622914161.0, 0.21428571428571427],
                           [1622918883.0, 0.2],
                           [1622977260.0, 0.1875],
                           [1622991216.0, 0.17647058823529413],
                           [1623003016.0, 0.2222222222222222],
                           [1623083517.0, 0.21052631578947367],
                           [1623244210.0, 0.2],
                           [1623267881.0, 0.19047619047619047],
                           [1623326349.0, 0.22727272727272727],
                           [1623340375.0, 0.2608695652173913],
                           [1623346065.0, 0.25],
                           [1623363949.0, 0.28],
                           [1623497683.0, 0.3076923076923077],
                           [1623595046.0, 0.2962962962962963]]}]
                    }
                });
            }

            function ajaxCalls() {
                return [
                    $.ajax({
                        url: heroMatchesPlayedLink,
                        dataType: 'json'
                    }),
                    $.ajax({
                        url: heroMatchesWonLink,
                        dataType: 'json'
                    }),
                    $.ajax({
                        url: heroWinRatesLink,
                        dataType: 'json'
                    }),
                    $.ajax({
                        url: totalTeamHeroesLink,
                        dataType: 'json'
                    })
                ];
            }

            $.when.apply($, ajaxCalls()).then(createHighchart);
        </script>
    </body>
</html>